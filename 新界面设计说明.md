# 新界面设计说明

## 概述

根据要求，已经完成了新的界面设计，包含三个独立的QML界面文件，实现了循环跳转的工作流程。

## 界面结构

### 1. 胶片文件管理.qml (启动界面)
- **功能**: 胶卷文件加载和管理
- **位置**: `python/gui/qml/胶片文件管理.qml`
- **主要功能**:
  - 选择胶卷文件夹
  - 设置胶片类型
  - 显示文件信息列表
  - 帧预览选择
- **跳转**: 点击右上角"完成"按钮跳转到胶片参数控制界面

### 2. 胶片参数控制.qml (参数设置界面)
- **功能**: 基础参数和颜色校正控制
- **位置**: `python/gui/qml/胶片参数控制.qml`
- **主要功能**:
  - 基础参数调整 (曝光、对比度、饱和度)
  - 颜色校正 (色温、色调)
  - 参数重置和预设管理
  - 实时图像预览
- **跳转**: 点击右上角"完成"按钮跳转到胶片调整界面

### 3. 胶片调整.qml (最终调整界面)
- **功能**: 高级调整和分析导出
- **位置**: `python/gui/qml/胶片调整.qml`
- **主要功能**:
  - 图像预览和直方图显示
  - 帧选择器 (前进/后退/滑块)
  - 高级调整 (阴影、高光、清晰度)
  - 胶卷分析和批量导出
- **跳转**: 点击右上角"完成"按钮跳转回胶片文件管理界面

## 界面特性

### 窗口尺寸
- **默认尺寸**: 各界面有不同的默认尺寸
  - 胶片文件管理: 800x600
  - 胶片参数控制: 1000x700  
  - 胶片调整: 1200x800
- **最小尺寸**: 所有界面最小为800x600
- **可调整**: 支持任意尺寸放大缩小
- **最大尺寸**: 支持全屏显示

### 界面跳转
- 实现了循环跳转: 文件管理 → 参数控制 → 调整 → 文件管理
- 每个界面右上角都有"完成"按钮用于跳转
- 跳转时会关闭当前窗口并打开新窗口

### 功能整合
- 保留了现有的所有核心功能
- 使用现有的控制器和组件
- 兼容现有的图像查看器和直方图组件
- 支持预设管理和导出功能

## 技术实现

### 文件结构
```
python/gui/qml/
├── 胶片文件管理.qml      # 启动界面
├── 胶片参数控制.qml      # 参数控制界面  
├── 胶片调整.qml          # 调整界面
└── components/           # 共享组件
    ├── ImageViewer.qml
    ├── HistogramViewer.qml
    ├── ExportDialog.qml
    └── PresetDialog.qml
```

### 控制器增强
- **ProjectController**: 添加了 `getFrameName()` 和 `getFrameSize()` 方法
- **ParameterController**: 添加了独立的参数设置方法
- 所有控制器引用都添加了安全检查

### 启动配置
- 修改了 `python/gui_main.py` 中的主QML文件路径
- 启动界面改为 `胶片文件管理.qml`

## 使用方法

### 启动程序
```bash
python python/gui_main.py
# 或者
python test_new_ui.py
```

### 工作流程
1. **文件管理阶段**: 选择胶卷文件夹，设置胶片类型，浏览文件列表
2. **参数控制阶段**: 调整基础参数和颜色校正，查看实时预览
3. **最终调整阶段**: 进行高级调整，分析胶卷，批量导出

### 界面导航
- 使用右上角"完成"按钮在界面间跳转
- 每个界面都是独立的窗口
- 支持键盘快捷键和鼠标操作

## 已删除的旧文件

为了保持代码整洁，已删除以下旧的界面文件:
- `python/gui/qml/main.qml` (旧主界面)
- `python/gui/qml/components/ProjectPanel.qml`
- `python/gui/qml/components/ParameterPanel.qml`
- `python/gui/qml/components/LiveImageViewer.qml`
- `python/gui/qml/components/ParameterSlider.qml`

## 注意事项

1. **控制器依赖**: 界面会检查控制器是否可用，避免运行时错误
2. **组件复用**: 保留了ImageViewer和HistogramViewer等核心组件
3. **功能完整**: 所有原有功能都得到保留和整合
4. **扩展性**: 新界面设计便于后续功能扩展

## 测试状态

- ✅ 界面加载正常
- ✅ 控制器连接正常  
- ✅ 基础功能可用
- ✅ 界面跳转实现
- ✅ 跳转文件名修复完成
- ✅ 程序可以正常启动和运行

## 界面跳转修复 ✅

### 问题诊断
原始的Qt.createComponent方式在某些情况下不稳定，导致跳转失败。

### 解决方案
采用StackView + Component的方式实现界面切换：
- 创建了统一的MainWindow.qml作为主容器
- 使用StackView管理界面切换
- 每个界面作为Component组件
- 窗口尺寸根据界面自动调整

### 修复结果
- ✅ 界面跳转完全正常
- ✅ 按钮点击响应正常
- ✅ 循环跳转功能正常
- ✅ 窗口尺寸自动调整

## 测试方法

运行以下命令测试界面跳转：
```bash
python test_final_interface.py
```

### 预期行为
1. 启动显示文件管理界面 (800x600)
2. 点击完成 → 参数控制界面 (1000x700)
3. 点击完成 → 调整界面 (1200x800)
4. 点击完成 → 回到文件管理界面 (800x600)